---
id: P0.2
title: "Posting Pipeline (Summary → Requirements → Facets)"
phase: 0
status: completed
owner: arden
priority: critical
completed_date: 2026-01
effort: 40h
---

# P0.2 Posting Pipeline

## Goal

Transform raw job descriptions into structured, matchable data.

## Status: ✅ COMPLETED

## The Pipeline

```
job_description (raw HTML/text)
    ↓
extracted_summary (clean, English, requirements-focused)
    ↓
extracted_requirements (JSON array of quoted requirements)
    ↓
posting_facets (CPS dimensions per requirement)
```

### Stage 1: Summary Extraction

**Actor:** `postings__extracted_summary_U.py`

**Input:** `job_description` (or `job_description_en` for non-English)

**Output:** `extracted_summary` — Cleaned, English, fluff-free summary focused on requirements.

**Example:**
```
Input: "Join our dynamic team! We're looking for a passionate..."
Output: "Senior Python Developer. Requirements: 5+ years Python, 
        experience with Django/FastAPI, AWS deployment..."
```

### Stage 2: Requirements Extraction

**Actor:** `postings__extracted_requirements_U.py`

**Input:** `extracted_summary`

**Output:** `extracted_requirements` — JSON array of exact quotes.

```json
[
    {"quote": "5+ years Python experience", "importance": "required"},
    {"quote": "Django or FastAPI framework knowledge", "importance": "required"},
    {"quote": "AWS deployment experience", "importance": "preferred"}
]
```

**QA:** Bidirectional verification — each quote must exist in the summary. Hallucinated quotes rejected.

### Stage 3: Facet Decomposition

**Actor:** `posting_facets__row_C.py`

**Input:** `extracted_requirements`

**Output:** `posting_facets` table rows — One row per requirement, decomposed into CPS dimensions.

```sql
posting_facets (
    facet_id, posting_id,
    skill,              -- "Python"
    experience_years,   -- 5
    certificate,        -- NULL
    track_record,       -- NULL
    domain,             -- "software development"
    seniority,          -- "senior"
    setting,            -- "backend"
    role,               -- "developer"
    weight              -- 85 (importance score)
)
```

## Cascade Triggers

When upstream data changes, downstream auto-invalidates:
- `extracted_summary` change → NULLs `extracted_requirements`
- `extracted_requirements` change → DELETEs `posting_facets` rows
- History archived to `attribute_history` table

## Metrics

| Metric | Value |
|--------|-------|
| Postings processed | 1,844 |
| Facets extracted | 10,690 |
| Success rate | 100% |
| Avg facets per posting | 5.8 |

## Lessons Learned

1. **Quote verification** — Catches hallucinations without expensive cross-model QA.
2. **Language normalization early** — Translate before extraction so quotes match.
3. **P90 cutoff** — Reject inputs beyond 90th percentile size. Outliers cause format errors.
4. **Weight from importance** — "Required" = 85, "Preferred" = 60, "Nice to have" = 40.
