---
id: P1.4
title: "Match Endpoints"
phase: 1
status: complete
owner: arden
priority: high
depends_on: [P1.2, P1.3]
effort: 3h
completed: 2026-01-27
---

# P1.4 Match Endpoints

## Goal

Users can view their job matches through the API. Returns scored matches with transparency data.

## Current Schema

```sql
profile_posting_matches (
    match_id, profile_id, posting_id,
    skill_match_score, domain_gate_passed, overall_score,
    user_rating, user_applied, user_feedback,
    computed_at, model_version
)
```

## API Endpoints

| Method | Path | Purpose |
|--------|------|---------|
| GET | `/matches` | List user's matches (paginated) |
| GET | `/matches/{id}` | Single match details |
| GET | `/matches/{id}/report` | Full transparency report |
| GET | `/matches/{id}/visualization` | UMAP data for frontend |
| POST | `/matches/{id}/feedback` | Submit rating/feedback |

## Query Parameters

```
GET /matches?
    status=recommended|skipped|all
    min_score=0.7
    sort=score|date
    limit=20
    offset=0
```

## Response Models

```python
class MatchSummary(BaseModel):
    match_id: int
    posting_id: int
    job_title: str
    company: str
    location: str
    score: float
    recommendation: str  # APPLY | SKIP
    computed_at: datetime

class MatchDetail(BaseModel):
    # ... MatchSummary fields
    skill_breakdown: list[SkillMatch]
    concerns: list[str] | None
    reasons_to_apply: list[str] | None
    cover_letter: str | None

class SkillMatch(BaseModel):
    requirement: str
    matched_skill: str | None
    similarity: float
    status: str  # matched | partial | gap
```

## Flow

```
GET /matches
    ↓
Query profile_posting_matches WHERE profile.user_id = current_user
    ↓
Join with postings for job details
    ↓
Return paginated list
```

## Acceptance Criteria

- [x] User sees only their own matches
- [x] Matches sorted by score (descending) by default
- [x] Pagination works (limit/offset)
- [x] `/matches/{id}/report` returns markdown report
- [x] Feedback endpoint updates user_rating/user_applied

**Verified:** 2026-01-27 — All endpoints in [api/routers/matches.py](api/routers/matches.py)
- GET `/api/matches` — list with filtering
- GET `/api/matches/{id}` — detail with skill breakdown
- GET `/api/matches/{id}/report` — markdown report
- POST `/api/matches/{id}/rate` — 1-5 rating
- POST `/api/matches/{id}/applied` — mark applied

## Sandy's Notes

The report endpoint can return raw markdown — let the frontend render it.

For visualization, return the UMAP coordinates + cluster labels as JSON. Frontend plots it.

Don't recompute matches on every request. Return cached results from `profile_posting_matches`. Fresh matches come from the scheduled job (P2.1).
