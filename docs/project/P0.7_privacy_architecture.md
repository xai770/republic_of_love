---
id: P0.7
title: "Privacy-First Architecture"
phase: 0
status: proposed
owner: sage
priority: critical
effort: 8-12h
reviewed_by: perplexity.ai (2026-01-26)
---

# P0.7 Privacy-First Architecture

> **Review status:** Draft reviewed by Perplexity.ai. Feedback incorporated:
> - âœ… Tightened risk language (no "nothing to steal" â€” acknowledge residual risk)
> - âœ… Added explicit granularity policy table (skills, domains, projects, locations)
> - âœ… Added legal hold / audit export step before column drops
> - âœ… Converted answered questions to resolved decisions
> - â³ Pending: legal/infosec final review

## Goal

Store minimal personal data. Extract skills, discard source. User identity = Google token only.

## Status: ğŸ“‹ PROPOSED

## The Principle

> "talent.yoga doesn't store your CV. We understand your skills, then forget the rest."

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  WHAT WE STORE                 â”‚  WHAT WE DON'T STORE              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  google_id (opaque token)      â”‚  Name (fetch from Google live)    â”‚
â”‚  skill facets ("Python")       â”‚  CV text                          â”‚
â”‚  durations ("3 years")         â”‚  Work history descriptions        â”‚
â”‚  domains ("banking")           â”‚  Company names                    â”‚
â”‚  preferences (location, etc)   â”‚  Addresses, phone, email          â”‚
â”‚  match scores                  â”‚  Dates of employment              â”‚
â”‚  ratings/feedback              â”‚  Project names                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Why This Matters

| Concern | How we address it |
|---------|-------------------|
| **GDPR compliance** | Minimal data = minimal liability |
| **Data breach risk** | Substantially reduced sensitivity and liability (see Residual Risk below) |
| **User trust** | "We don't keep your CV" is a feature |
| **Right to erasure** | Delete google_id â†’ user gone |
| **Differentiator** | Competitors hoard data; we don't |

### Residual Risk Acknowledgment

âš ï¸ **We do not claim "nothing sensitive to steal."**

Skill profiles + location + domain can still be quasi-identifying in niche combinations. Example: "C-level + niche fintech + Luxembourg" might identify a small set of people.

Mitigations:
- Granularity limits (see below)
- No raw text storage
- Facet combinations reviewed periodically for re-identification risk

---

## Architecture

### The DMZ Model

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. USER INPUT                                                      â”‚
â”‚     â€¢ User uploads CV (PDF/text) OR                                 â”‚
â”‚     â€¢ User types work history in chat                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. DMZ PROCESSING (ephemeral, nothing persists)                    â”‚
â”‚                                                                     â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚     â”‚   Clara     â”‚ â†’  â”‚  Scrubber   â”‚ â†’  â”‚   Output    â”‚           â”‚
â”‚     â”‚  (Extract)  â”‚    â”‚  (Validate) â”‚    â”‚  (Facets)   â”‚           â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                     â”‚
â”‚     Clara extracts:     Scrubber checks:   Output contains:         â”‚
â”‚     â€¢ Skills            â€¢ No names         â€¢ skill_text             â”‚
â”‚     â€¢ Years             â€¢ No companies     â€¢ years_experience       â”‚
â”‚     â€¢ Domain            â€¢ No addresses     â€¢ domain                 â”‚
â”‚     â€¢ Seniority         â€¢ No dates         â€¢ seniority_level        â”‚
â”‚                         â€¢ No PII patterns  â€¢ location_preference    â”‚
â”‚                                                                     â”‚
â”‚     âš ï¸ Source text NEVER leaves DMZ                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. MAIN DATABASE                                                   â”‚
â”‚                                                                     â”‚
â”‚     users:                                                          â”‚
â”‚       google_id        (opaque, from OAuth)                         â”‚
â”‚       display_name     âŒ NOT STORED (fetch live from Google)       â”‚
â”‚       email            âŒ NOT STORED (fetch live from Google)       â”‚
â”‚       created_at                                                    â”‚
â”‚       preferences      (JSONB: location, salary, remote, Du/Sie)    â”‚
â”‚                                                                     â”‚
â”‚     profile_facets:                                                 â”‚
â”‚       user_id          (FK to users.google_id)                      â”‚
â”‚       skill_text       ("Python", "Projektmanagement")              â”‚
â”‚       years            (3, 5, 10)                                   â”‚
â”‚       domain           ("banking", "healthcare")                    â”‚
â”‚       seniority        ("senior", "lead")                           â”‚
â”‚       source           ("extracted", "user_confirmed")              â”‚
â”‚                                                                     â”‚
â”‚     profile_posting_matches:                                        â”‚
â”‚       (unchanged â€” works on facets, not PII)                        â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## The Scrubber Persona

### Purpose

Second-pass validation that Clara's output contains no PII.

### Granularity Policy (Configurable)

Explicit rules to avoid ad-hoc decisions:

| Category | ALLOW | REJECT |
|----------|-------|--------|
| **Skills** | Generic names ("Python", "Project Management") | Product-specific ("SAP S/4HANA Migration Tool v2.3") |
| **Domains** | Sector level ("banking", "automotive", "healthcare") | Company-identifying ("large German automaker's EV platform") |
| **Projects** | Generic scope ("payment system migration", "compliance automation") | Named projects ("SEPA", "T2S", "Basel III implementation") |
| **Location** | City level ("Frankfurt", "MÃ¼nchen", "Berlin") | District/street ("Sachsenhausen", "Maxvorstadt") |
| **Seniority** | Level ("senior", "lead", "principal") | Titles with org ("VP at X", "Head of Y") |
| **Duration** | Ranges ("3 years", "5+ years", "10+ years") | Specific dates ("2019-2023", "since March 2021") |

**Tunable parameter:** `granularity_level` (conservative / balanced / permissive)
- **Conservative:** Reject anything borderline (MVP default)
- **Balanced:** Allow generic project types, reject named projects
- **Permissive:** Allow more domain specificity (future, with user consent)

### Prompt (Draft)

```
You are the Scrubber. Your job is to verify that extracted skill facets 
contain NO personally identifiable information.

REJECT if you see:
- Names (people, companies, products)
- Addresses, cities (except as location preference)
- Dates (specific years, months)
- Phone numbers, emails
- Project names that could identify someone
- Any combination that could identify a specific person

ACCEPT if you see only:
- Generic skill names ("Python", "Project Management")
- Durations ("3 years", "5+ years")
- Domains ("banking", "healthcare", "automotive")
- Seniority levels ("junior", "senior", "lead")
- Role types ("developer", "manager", "analyst")

Input: {clara_output}

Output JSON:
{
  "decision": "ACCEPT" | "REJECT",
  "concerns": ["list of specific PII found, if any"],
  "sanitized": {facets with any borderline items removed}
}
```

### What Gets Flagged

| Input | Clara extracts | Scrubber says |
|-------|---------------|---------------|
| "5 years at Deutsche Bank" | "banking, 5 years" | âœ… ACCEPT |
| "Led SEPA migration at DB" | "SEPA migration, banking" | âš ï¸ REJECT ("SEPA migration" too specific) |
| "Python developer in Frankfurt" | "Python, Frankfurt" | âœ… ACCEPT (city as preference is OK) |
| "Worked with Hans MÃ¼ller" | "team collaboration" | âœ… ACCEPT (name stripped) |
| "2019-2023 at BMW" | "automotive, 4 years" | âœ… ACCEPT (company/dates stripped) |

---

## Schema Changes

### Remove (or don't populate)

```sql
-- These columns exist but we stop writing to them:
ALTER TABLE profiles DROP COLUMN IF EXISTS full_name;
ALTER TABLE profiles DROP COLUMN IF EXISTS email;
ALTER TABLE profiles DROP COLUMN IF EXISTS phone;

-- Work history: keep structure, anonymize content
ALTER TABLE profile_work_history 
  DROP COLUMN IF EXISTS company_name,
  DROP COLUMN IF EXISTS description;
-- Keep: job_title (generic), start_year (as duration), domain
```

### Add

```sql
-- User preferences (non-PII)
ALTER TABLE users ADD COLUMN preferences JSONB DEFAULT '{}';
-- Example: {"location": "Frankfurt", "remote": true, "salary_min": 80000, "formality": "du"}

-- Facet source tracking
ALTER TABLE profile_facets ADD COLUMN source TEXT DEFAULT 'extracted';
-- Values: 'extracted' (from CV), 'user_confirmed', 'user_added'
```

---

## Cover Letters Without PII

### Current approach (requires name + company)

> "Dear Hiring Manager, my experience at Deutsche Bank in compliance..."

### New approach (facets only)

> "Dear Hiring Manager, my experience in banking compliance over the past 5 years..."

**Name injection:** Fetch from Google OAuth at render time, insert into template. Never stored.

```python
def generate_cover_letter(user_id, posting_id):
    # Fetch name live from Google (not from our DB)
    google_profile = get_google_profile(user_id)  # OAuth token refresh
    name = google_profile.get('name', 'Applicant')
    
    # Get facets (no PII)
    facets = get_user_facets(user_id)
    
    # Generate letter with facets + live name
    letter = llm_generate_cover_letter(
        name=name,  # From Google, not stored
        skills=facets.skills,
        domain=facets.domain,
        years=facets.years,
        posting=get_posting(posting_id)
    )
    
    return letter  # Rendered, not stored
```

---

## Chat History

### The question

Chat messages might contain PII. Same treatment?

### Options

| Option | Approach | Trade-off |
|--------|----------|-----------|
| **A: Don't store** | Chat is ephemeral, gone on session end | User loses context between sessions |
| **B: Store anonymized** | Run Scrubber on each message before save | Complex, might miss things |
| **C: User-controlled** | "Save this conversation?" explicit opt-in | Extra friction |
| **D: Encrypted** | Store encrypted, user's key from Google | Complex, but recoverable |

### Recommendation: Option A for MVP

Chat is ephemeral. Each session starts fresh. The *outcomes* of chat (facets extracted, ratings given) persist. The conversation itself doesn't.

Later: Add Option C (explicit save) for users who want continuity.

---

## User Visibility

### "What do you know about me?"

Users can see their extracted facets:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Your Profile (as we understand it)                                 â”‚
â”‚                                                                     â”‚
â”‚  Skills: Python, SQL, Project Management, Compliance                â”‚
â”‚  Experience: 5+ years                                               â”‚
â”‚  Domain: Banking, Finance                                           â”‚
â”‚  Level: Senior                                                      â”‚
â”‚  Location preference: Frankfurt area, open to remote                â”‚
â”‚                                                                     â”‚
â”‚  [Edit] [Add skill] [Remove skill]                                  â”‚
â”‚                                                                     â”‚
â”‚  â„¹ï¸ We extracted this from your CV. The original CV was not stored. â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### User correction flow

1. User sees facets
2. User says "I also know Kubernetes"
3. Facet added with `source = 'user_added'`
4. No PII needed

---

## Implementation Tasks

| Task | Effort | Owner | Depends on |
|------|--------|-------|------------|
| 1. DMZ processing endpoint | 2h | arden | â€” |
| 2. Scrubber persona prompt | 2h | sage | â€” |
| 3. Schema changes (remove PII columns) | 1h | arden | â€” |
| 4. Cover letter from facets (no company names) | 2h | sage | #1 |
| 5. Google name fetch at render time | 1h | arden | P1.1 |
| 6. "Your profile" facet viewer | 2h | arden | #3 |
| 7. Chat ephemerality (don't persist) | 1h | arden | â€” |

**Total: ~11h**

---

## Migration Path

### For existing data (if any)

1. **Legal hold / audit export** â€” Export all PII columns to encrypted archive before any deletion
   - Store in offline, encrypted backup (not accessible to application)
   - Retain for regulator/complaint response period (consult legal: typically 3-7 years)
   - Document chain of custody
2. Run Scrubber on all existing `profile_facets` â†’ flag any PII
3. Delete or anonymize flagged records in production DB
4. Drop PII columns from schema
5. Update Clara's prompts to never extract company names
6. Verify audit export is complete before final column drop

### For new users

1. DMZ processes all input
2. Only facets reach main DB
3. User never sees "we stored your CV" â€” because we didn't
4. No PII columns exist to populate

---

## Risks & Mitigations

| Risk | Likelihood | Impact | Mitigation |
|------|------------|--------|------------|
| LLM extracts PII despite instructions | Medium | High | Scrubber second pass + granularity policy |
| Combination of facets identifies user | Medium | Medium | Granularity limits, periodic review of rare combinations |
| Rare niche combinations (C-level + tiny sector + small country) | Low | High | Conservative granularity default, future: k-anonymity checks |
| User wants their CV back | Medium | Low | Clear messaging: "we don't store it" |
| Cover letters feel generic | Medium | Medium | Good prompts, fetch name live |
| Google OAuth token expires | Low | Low | Refresh flow, graceful fallback |
| Regulator requests historical data | Low | Medium | Legal hold archive (encrypted, offline) |

---

## Success Criteria

- [ ] No PII in `profile_facets` table (audit passes)
- [ ] Cover letters include user's name (from Google, not DB)
- [ ] User can view/edit their facets
- [ ] "Delete my account" removes all traces (only google_id to delete)
- [ ] Chat history doesn't persist between sessions
- [ ] Scrubber catches 95%+ of PII in test cases

---

## Resolved Decisions

| Question | Decision | Rationale |
|----------|----------|----------|
| **Company â†’ domain** | Sector level only ("banking", not "large German bank") | Reduces re-identification; matching works on skills anyway |
| **Project names** | Generic scope only ("payment migration", not "SEPA") | Named projects too identifying; generic preserves signal |
| **Location** | City level only ("Frankfurt", not "Sachsenhausen") | Cities are common; districts narrow the population too much |

## Open Questions (Product Decisions)

1. **Domain granularity vs matching power:** "C-level + niche fintech + tiny country" is identifying even at sector level. Consider:
   - Different granularity for internal matching vs external display?
   - k-anonymity threshold (only show if 5+ users share same facet combo)?

2. **Opt-in CV storage:** Architecturally possible (separate encrypted store, clear consent, independent retention). Current bias: **resist until strong user-driven need.** Revisit post-MVP based on feedback.

3. **Chat persistence (Option C):** Only introduce when UX clearly distinguishes "saved" vs "ephemeral" conversations. Risk of users assuming everything is ephemeral when some isn't.

---

## References

- GDPR Article 5: Data minimization principle
- GDPR Article 17: Right to erasure
- [P0.4 Embedding Matching](P0.4_embedding_matching.md): How facets are matched
- [P1.1 User Authentication](P1.1_user_authentication.md): Google OAuth flow

---

*This is a proposal. Needs review from xai (vision), Arden (implementation), and eventually legal.*

â€” Sage  
2026-01-26
