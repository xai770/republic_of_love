---
id: P0.4
title: "Embedding-Based Skill Matching"
phase: 0
status: completed
owner: arden
priority: critical
completed_date: 2026-01-21
effort: 24h
---

# P0.4 Embedding-Based Skill Matching

## Goal

Match profile skills to job requirements using semantic similarity, not taxonomy lookup.

## Status: ✅ COMPLETED

## The Insight

**Old approach (abandoned):** Classify skills into OWL taxonomy → match via folder membership.

**New approach:** Embed skills → cosine similarity → direct matching.

```
"Projektmanagement" (profile) ↔ "Project Management" (job)
    ↓                              ↓
  [1024-dim vector]            [1024-dim vector]
    ↓                              ↓
         cosine_similarity = 0.93 → MATCH
```

## Why Embeddings Won

| Aspect | OWL Taxonomy | Embeddings |
|--------|--------------|------------|
| Synonym handling | Manual curation | Automatic |
| Multilingual | Translation required | Built-in (bge-m3) |
| New skills | Add to taxonomy | Works immediately |
| Maintenance | Ongoing | None |
| Accuracy | Depends on taxonomy quality | 87% (tested) |

## Implementation

### Model

- **Model:** bge-m3:567m (Ollama)
- **Dimensions:** 1024
- **Languages:** EN, DE, FR (multilingual)
- **Speed:** ~12 embeddings/sec

### Schema

```sql
embeddings (
    embedding_id SERIAL PRIMARY KEY,
    text TEXT UNIQUE,
    embedding VECTOR(1024),
    model_version TEXT,
    created_at TIMESTAMP
)

CREATE INDEX idx_embeddings_text ON embeddings(text);
```

### Thresholds

| Score | Meaning |
|-------|---------|
| ≥ 0.70 | Confident match |
| 0.60-0.69 | Partial match |
| < 0.60 | No match |

### Matching Flow

```python
def compute_match(profile_skills, job_requirements):
    results = []
    for req in job_requirements:
        best_match = None
        best_score = 0
        for skill in profile_skills:
            score = cosine_similarity(embed(req), embed(skill))
            if score > best_score:
                best_score = score
                best_match = skill
        results.append({
            'requirement': req,
            'matched_skill': best_match,
            'score': best_score
        })
    return weighted_average(results)
```

## Domain Gates

Embeddings handle semantics but not credentials. Added hard filters:

```python
RESTRICTED_DOMAINS = ['legal', 'medical', 'accounting_cpa']

def domain_gate(profile, posting):
    if posting.domain in RESTRICTED_DOMAINS:
        return profile.domain == posting.domain
    return True  # No gate
```

**Result:** "Legal Counsel" at 64.7% match → BLOCKED (profile lacks legal domain).

## Metrics

| Metric | Value |
|--------|-------|
| Embeddings cached | 4,620 |
| Avg match computation | <1 sec |
| QA accuracy (Gelinda) | 100% (5/5 correct) |
| False positive rate | <5% with domain gates |

## Lessons Learned

1. **Cross-lingual for free** — bge-m3 matches "Datenanalyse" ↔ "Data Analysis" at 0.77.
2. **Domain gates are essential** — High skill overlap ≠ qualified (Legal Counsel case).
3. **0.70 threshold empirical** — Tested on known matches; too low = noise, too high = misses.
4. **OWL deprecated for skills** — Keep for geography/orgs where relationships are facts.
