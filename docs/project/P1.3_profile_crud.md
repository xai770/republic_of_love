---
id: P1.3
title: "Profile CRUD"
phase: 1
status: complete
owner: arden
priority: high
depends_on: [P1.1, P1.2]
effort: 4h
completed: 2026-01-27
---

# P1.3 Profile CRUD

## Goal

Users can create, view, update their profile through the API. Profile data flows to matching pipeline.

## Current Schema

```sql
-- profiles table (exists)
profiles (
    profile_id, user_id, name, title, 
    location, skill_keywords, created_at, updated_at
)

-- profile_facets (exists) 
profile_facets (
    facet_id, profile_id, skill, experience_years,
    certificate, track_record, domain, seniority, setting, role
)

-- profile_work_history (exists)
profile_work_history (
    id, profile_id, company, title, start_date, end_date, description
)
```

## API Endpoints

| Method | Path | Purpose |
|--------|------|---------|
| GET | `/profiles/me` | Get current user's profile |
| PUT | `/profiles/me` | Update current user's profile |
| GET | `/profiles/me/facets` | Get extracted skills |
| POST | `/profiles/me/work-history` | Add work experience |
| PUT | `/profiles/me/work-history/{id}` | Update work experience |
| DELETE | `/profiles/me/work-history/{id}` | Delete work experience |

## Request/Response Models

```python
class ProfileUpdate(BaseModel):
    name: str
    title: str | None
    location: str | None
    skill_keywords: list[str] | None

class WorkHistoryCreate(BaseModel):
    company: str
    title: str
    start_date: date
    end_date: date | None  # None = current
    description: str | None

class ProfileFacet(BaseModel):
    skill: str
    experience_years: int | None
    certificate: str | None
    domain: str | None
    # ... other CPS dimensions
```

## Flow

```
User updates profile
    ↓
API saves to profiles/profile_work_history
    ↓
Triggers Clara extraction (async)
    ↓
profile_facets populated
    ↓
Triggers embedding generation
    ↓
Ready for matching
```

## Acceptance Criteria

- [x] Authenticated user can GET their profile
- [x] User can update basic info (name, title, location)
- [x] User can add/edit/delete work history entries
- [x] Profile changes trigger re-extraction
- [x] Cannot access other users' profiles

**Verified:** 2026-01-27 — All CRUD endpoints + async extraction wired up
- `extraction_status` column added to `profile_work_history`
- API sets `pending` on create/update
- `tools/run_pending_extractions.py` processes queue

## Sandy's Notes

Keep `/profiles/me` — don't expose arbitrary profile IDs. Users only see their own data.

Work history is the source of truth. Extracted facets are derived. Let users edit history, not facets directly.

The "trigger Clara extraction" step should be async — don't make the API call wait for LLM processing.
