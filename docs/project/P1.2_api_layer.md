---
id: P1.2
title: "API Layer"
phase: 1
status: complete
owner: arden
priority: critical
depends_on: []
effort: 6h
completed: 2026-01-27
---

# P1.2 API Layer

## Goal

FastAPI application that serves as the backend for the web frontend. Connects to turing database, exposes REST endpoints.

## Architecture

```
Frontend (React/Vue/Svelte) 
    ↓ HTTP
FastAPI (api/)
    ↓ psycopg2
PostgreSQL (turing)
```

## Project Structure

```
api/
├── __init__.py
├── main.py           # FastAPI app, CORS, routers
├── deps.py           # Dependencies (db, auth)
├── config.py         # Settings from .env
├── routers/
│   ├── auth.py       # Login/logout
│   ├── profiles.py   # Profile CRUD
│   ├── postings.py   # Job listings
│   ├── matches.py    # Match results
│   └── health.py     # Health check
└── models/
    ├── user.py       # Pydantic models
    ├── profile.py
    ├── posting.py
    └── match.py
```

## Implementation

1. **Setup**
   ```bash
   pip install fastapi uvicorn python-multipart
   ```

2. **Database connection**
   - Reuse `core/database.py` pattern
   - Connection pool for concurrent requests

3. **CORS configuration**
   - Allow frontend origin (localhost:3000 dev, talent.yoga prod)

4. **Error handling**
   - Consistent JSON error responses
   - Log errors to file

## Key Endpoints

| Method | Path | Purpose |
|--------|------|---------|
| GET | `/health` | Liveness check |
| GET | `/me` | Current user |
| GET | `/profiles/{id}` | Get profile |
| PUT | `/profiles/{id}` | Update profile |
| GET | `/postings` | List active jobs |
| GET | `/matches` | User's matches |
| GET | `/matches/{id}/report` | Full match report |

## Acceptance Criteria

- [x] `uvicorn api.main:app` starts without error
- [x] `/health` returns 200 (`{"status":"healthy","database":"connected"}`)
- [x] `/docs` shows OpenAPI spec (200)
- [x] Database queries work
- [x] CORS allows frontend origin

**Verified:** 2026-01-27 — all routers present (auth, profiles, postings, matches, dashboard, visualization, health)

## Sandy's Notes

Don't over-engineer. No GraphQL, no microservices. One FastAPI app, one database.

Use Pydantic for request/response validation. Let it do the work.

Start with `/health` and `/me` — get the skeleton working before adding features.
