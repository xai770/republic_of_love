---
id: P4.3
title: "Threshold Tuning"
phase: 4
status: done
owner: sandy
priority: medium
depends_on: [P4.1, P4.2]
effort: 4h
completed: 2026-01-27
---

# P4.3 Threshold Tuning

## Goal

Use user feedback (ratings + application outcomes) to calibrate match thresholds.

## Current Thresholds

```python
MATCH_THRESHOLDS = {
    "strong": 0.70,   # Green badge, high confidence
    "partial": 0.60,  # Yellow badge, worth reviewing
    "cutoff": 0.50    # Below this, don't show
}
```

These are educated guesses. Real data will refine them.

## Calibration Metrics

### From Ratings (P4.1)

```sql
-- Are users happy with "strong" matches?
SELECT 
    CASE 
        WHEN weighted_score >= 0.70 THEN 'strong'
        WHEN weighted_score >= 0.60 THEN 'partial'
        ELSE 'low'
    END as tier,
    AVG(CASE WHEN rating = 1 THEN 1.0 ELSE 0.0 END) as approval_rate,
    COUNT(*) as sample_size
FROM profile_posting_matches m
JOIN match_ratings r ON r.match_id = m.id
GROUP BY 1;
```

**Healthy state:** Strong tier has 80%+ approval rate.

**Problem signals:**
- Strong tier < 70% approval → threshold too low (false positives)
- Partial tier > 60% approval → threshold too high (missing good matches)

### From Applications (P4.2)

```sql
-- Which scores lead to interviews/offers?
SELECT 
    ROUND(weighted_score, 1) as score_bucket,
    COUNT(*) as applications,
    SUM(CASE WHEN outcome = 'interviewing' OR outcome = 'offered' THEN 1 ELSE 0 END) as progressed,
    AVG(CASE WHEN outcome = 'interviewing' OR outcome = 'offered' THEN 1.0 ELSE 0.0 END) as progression_rate
FROM profile_posting_matches m
JOIN applications a ON a.match_id = m.id
WHERE a.outcome IS NOT NULL
GROUP BY 1
ORDER BY 1 DESC;
```

## Threshold Adjustment Rules

| Signal | Action |
|--------|--------|
| Strong tier < 70% approval | Raise strong threshold (0.70 → 0.75) |
| Partial tier > 60% approval | Lower strong threshold (0.70 → 0.65) |
| Low scores getting hired | Lower cutoff |
| High scores getting rejected consistently | Investigate false positive patterns |

## Domain-Specific Calibration

Thresholds may vary by industry:

```python
DOMAIN_THRESHOLDS = {
    "default": {"strong": 0.70, "partial": 0.60},
    "legal": {"strong": 0.80, "partial": 0.70},      # Higher bar
    "tech": {"strong": 0.65, "partial": 0.55},       # Skills transfer more
}
```

## Monitoring Dashboard

```sql
-- Weekly calibration check
WITH weekly_ratings AS (
    SELECT 
        DATE_TRUNC('week', r.created_at) as week,
        CASE 
            WHEN m.weighted_score >= 0.70 THEN 'strong'
            WHEN m.weighted_score >= 0.60 THEN 'partial'
            ELSE 'low'
        END as tier,
        AVG(CASE WHEN r.rating = 1 THEN 1.0 ELSE 0.0 END) as approval
    FROM match_ratings r
    JOIN profile_posting_matches m ON m.id = r.match_id
    GROUP BY 1, 2
)
SELECT * FROM weekly_ratings
ORDER BY week DESC, tier;
```

## A/B Testing (Future)

Eventually, test threshold variations:

```sql
CREATE TABLE threshold_experiments (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    strong_threshold DECIMAL(3,2),
    partial_threshold DECIMAL(3,2),
    user_cohort VARCHAR(50),  -- 'A' or 'B'
    start_at TIMESTAMPTZ,
    end_at TIMESTAMPTZ
);
```

50% of users see current thresholds, 50% see variant. Compare satisfaction.

## Implementation

```python
# core/matching/thresholds.py

def get_thresholds(user_id: int, domain: str = None) -> dict:
    # Check if user is in experiment
    experiment = get_active_experiment(user_id)
    if experiment:
        return {
            "strong": experiment.strong_threshold,
            "partial": experiment.partial_threshold
        }
    
    # Domain-specific defaults
    if domain in DOMAIN_THRESHOLDS:
        return DOMAIN_THRESHOLDS[domain]
    
    return DOMAIN_THRESHOLDS["default"]
```

## Acceptance Criteria

- [ ] Calibration query runs weekly (cron or Turing workflow)
- [ ] Alert if strong tier approval drops below 70%
- [ ] Dashboard shows approval rate by tier over time
- [ ] Domain-specific thresholds configurable
- [ ] A/B test infrastructure ready (can defer)
- [ ] Threshold changes logged with rationale
