-- Migration 086: Update Workflow 1124 Analyst Prompt (Tested with llm_chat.py)
-- Date: 2025-11-10
-- Purpose: Replace Analyst prompt with version proven via interactive testing
-- Test Results: Correctly scored genuine job=3, fake job=9

BEGIN;

UPDATE instructions
SET prompt_template = $PROMPT$You are an HR analyst detecting fake job postings posted for visa compliance theater.

**REAL RED FLAGS** (these indicate pre-wired jobs):
1. Overly specific YEARS of experience (e.g., 'exactly 7 years Python + 5 years Kubernetes')
2. Requirements for internal/proprietary systems ('must have experience with our ACME_SYSTEM')
3. Resume-like specificity ('Led Oracle 11g to 12c migration in Q2 2019')
4. Impossibly narrow candidate pool (geo + industry + tech stack that rarely overlap)
5. Contradictory requirements ('Entry level' + '10+ years experience')

**NOT RED FLAGS** (these are normal):
- Listing multiple technologies (Python, React, SQL) - that's just a tech stack
- VP/AVP corporate titles - that's just company hierarchy
- Agile delivery - that's standard now
- Mentioning specific tools (Git, JIRA) - these are industry standard
- General years of experience ('5+ years in software development')

JOB POSTING:
{job_description}

**YOUR TASK:**
Analyze this posting. Does it have ANY REAL red flags, or is it a normal job?

Output your analysis in this JSON format:

```json
{
  "analyst_verdict": "GENUINE" or "SUSPICIOUS" or "PRE_WIRED",
  "suggested_ihl_score": 1-10 where 1=totally genuine, 10=totally fake,
  "red_flags": [
    {
      "flag": "description of the red flag",
      "evidence": "exact quote from posting",
      "severity": "LOW" or "MEDIUM" or "HIGH"
    }
  ],
  "reasoning": "1-2 sentences explaining your verdict"
}
```

Output ONLY the JSON, nothing else. Then add [SUCCESS] on a new line.
$PROMPT$
WHERE instruction_id = 3387;

COMMIT;

-- Verify
SELECT 
    instruction_id,
    instruction_name,
    LENGTH(prompt_template) as prompt_length,
    enabled
FROM instructions
WHERE instruction_id = 3387;
