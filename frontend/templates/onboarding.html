<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Welcome â€” talent.yoga</title>
    <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="/static/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/static/favicon-16x16.png">
    <style>
        /* â”€â”€ Reset & base â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            min-height: 100vh;
            background: linear-gradient(135deg, #4ade80 0%, #c4956a 45%, #7dd3fc 100%);
            display: flex; align-items: center; justify-content: center;
            overflow: hidden;
        }

        /* â”€â”€ Frosted-glass card â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .wizard {
            width: min(620px, 92vw);
            min-height: 420px;
            background: rgba(255,255,255,.88);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 24px;
            box-shadow: 0 8px 32px rgba(0,0,0,.18);
            padding: 40px 44px 36px;
            position: relative;
            display: flex; flex-direction: column;
            transition: opacity .35s ease, transform .35s ease;
        }
        .wizard.fade-out { opacity: 0; transform: translateY(12px); pointer-events: none; }

        /* â”€â”€ Step counter â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .step-counter {
            position: absolute; top: 18px; right: 24px;
            font-size: 13px; color: #94a3b8; font-weight: 500;
            letter-spacing: .4px;
        }

        /* â”€â”€ Step panels â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .step { display: none; flex-direction: column; gap: 24px; flex: 1; }
        .step.active { display: flex; }

        .step h2 {
            font-size: 24px; font-weight: 700; color: #1e293b;
            line-height: 1.25;
        }
        .step p {
            font-size: 15px; color: #475569; line-height: 1.65;
        }

        /* â”€â”€ Flag buttons (step 1) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .flag-row {
            display: flex; gap: 32px; justify-content: center;
            margin-top: 12px;
        }
        .flag-btn {
            width: 130px; height: 130px;
            border-radius: 20px;
            border: 3px solid transparent;
            background: #f8fafc;
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            gap: 10px; cursor: pointer;
            transition: all .2s;
            font-size: 56px;
            position: relative;
        }
        .flag-btn:hover { border-color: #0d9488; transform: translateY(-4px); box-shadow: 0 6px 20px rgba(13,148,136,.18); }
        .flag-btn.selected { border-color: #0d9488; background: #ccfbf1; }
        .flag-label {
            font-size: 14px; font-weight: 600; color: #4b5563;
            opacity: 0; transition: opacity .2s;
        }
        .flag-btn:hover .flag-label, .flag-btn.selected .flag-label { opacity: 1; }

        /* â”€â”€ Germany map (step 2) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .germany-visual {
            display: flex; flex-direction: column; align-items: center; gap: 16px;
            margin: 8px 0;
        }
        .germany-svg { width: 180px; height: auto; }
        .germany-map-img { width: 220px; height: auto; filter: drop-shadow(2px 3px 6px rgba(0,0,0,0.15)); }
        .info-box {
            background: #fef3c7; border-radius: 12px; padding: 16px 20px;
            border-left: 4px solid #f59e0b;
        }
        .info-box p { color: #92400e; font-size: 14px; }

        /* â”€â”€ Du/Sie cards (step 3) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .formality-row {
            display: flex; gap: 20px; justify-content: center;
            margin-top: 8px;
        }
        .formality-card {
            flex: 1; max-width: 200px;
            padding: 28px 20px;
            border-radius: 16px;
            border: 2px solid #e2e8f0;
            background: #fff;
            text-align: center;
            cursor: pointer;
            transition: all .2s;
        }
        .formality-card:hover { border-color: #0d9488; transform: translateY(-2px); }
        .formality-card.selected { border-color: #0d9488; background: #ccfbf1; }
        .formality-card .big { font-size: 28px; font-weight: 700; color: #1e293b; }
        .formality-card .desc { font-size: 13px; color: #64748b; margin-top: 6px; }

        /* â”€â”€ Privacy (step 4) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .privacy-content {
            background: #f8fafc; border-radius: 14px; padding: 20px 22px;
            max-height: 320px; overflow-y: auto;
            border: 1px solid #e2e8f0;
        }
        .privacy-content ul { list-style: none; padding: 0; }
        .privacy-content li {
            padding: 6px 0;
            font-size: 14px; color: #334155;
            display: flex; align-items: flex-start; gap: 8px;
        }
        .privacy-content li::before { content: "âœ“"; color: #22c55e; font-weight: 700; flex-shrink: 0; }
        .btn-row-privacy { display: flex; gap: 12px; margin-top: 4px; }

        /* â”€â”€ Gender selector (step 5) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .gender-row {
            display: flex; gap: 12px; justify-content: center;
            margin-bottom: 4px;
        }
        .gender-btn {
            padding: 8px 20px; border-radius: 20px;
            border: 2px solid #e2e8f0; background: #fff;
            font-size: 14px; font-weight: 500; color: #475569;
            cursor: pointer; transition: all .2s;
        }
        .gender-btn:hover { border-color: #5eead4; }
        .gender-btn.selected { border-color: #0d9488; background: #ccfbf1; color: #115e59; }

        /* â”€â”€ Taro name grid (step 6) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .name-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-top: 8px;
        }
        .name-chip {
            padding: 12px 8px;
            border-radius: 12px;
            border: 2px solid #e2e8f0;
            background: #fff;
            text-align: center;
            font-size: 14px; font-weight: 500; color: #334155;
            cursor: pointer;
            transition: all .2s;
            word-break: break-word;
        }
        .name-chip:hover { border-color: #5eead4; background: #f0fdfa; transform: translateY(-1px); }
        .name-chip.selected { border-color: #0d9488; background: #ccfbf1; color: #115e59; font-weight: 700; }
        .grid-footer {
            display: flex; justify-content: center; margin-top: 8px; gap: 12px;
        }

        /* â”€â”€ Manual entry (step 7) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .manual-input {
            width: 100%;
            padding: 14px 18px;
            border-radius: 12px;
            border: 2px solid #e2e8f0;
            font-size: 16px;
            font-family: inherit;
            outline: none;
            transition: border-color .2s;
        }
        .manual-input:focus { border-color: #0d9488; }
        .validation-msg {
            font-size: 13px; min-height: 20px;
            padding: 0 4px;
        }
        .validation-msg.warning { color: #d97706; }
        .validation-msg.error { color: #dc2626; }
        .validation-msg.ok { color: #16a34a; }

        /* â”€â”€ Buttons â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .btn {
            padding: 12px 28px;
            border-radius: 12px;
            font-size: 15px; font-weight: 600;
            border: none; cursor: pointer;
            transition: all .2s;
            display: inline-flex; align-items: center; gap: 6px;
        }
        .btn-primary {
            background: #0d9488; color: #fff;
        }
        .btn-primary:hover { background: #0f766e; }
        .btn-primary:disabled { background: #99f6e4; cursor: not-allowed; }
        .btn-secondary {
            background: transparent; color: #64748b;
            border: 2px solid #e2e8f0;
        }
        .btn-secondary:hover { border-color: #94a3b8; color: #334155; }
        .btn-danger {
            background: transparent; color: #dc2626;
            border: 2px solid #fecaca;
        }
        .btn-danger:hover { background: #fef2f2; }
        .btn-ghost {
            background: transparent; color: #0d9488;
            border: none; text-decoration: underline;
            padding: 8px 12px;
        }
        .btn-row {
            display: flex; justify-content: space-between; align-items: center;
            margin-top: auto; padding-top: 16px;
        }
        .btn-row-right { justify-content: flex-end; gap: 12px; }

        /* â”€â”€ Loading spinner â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .spinner { display: inline-block; width: 18px; height: 18px;
            border: 2px solid #99f6e4; border-top-color: #0d9488;
            border-radius: 50%; animation: spin .6s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* â”€â”€ Dismissed/rejected screen â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .dismissed-screen {
            display: none;
            position: fixed; inset: 0;
            background: #fff;
            z-index: 100;
            flex-direction: column;
            align-items: center; justify-content: center;
            gap: 16px;
        }
        .dismissed-screen.active { display: flex; }
        .dismissed-screen p {
            font-size: 18px; color: #64748b;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        /* â”€â”€ Responsive â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        @media (max-width: 520px) {
            .wizard { padding: 28px 24px 24px; }
            .flag-btn { width: 100px; height: 100px; font-size: 44px; }
            .name-grid { grid-template-columns: repeat(3, 1fr); }
        }
    </style>
</head>
<body>

<!-- â”€â”€ Dismissed screen (privacy reject / cancel) â”€â”€â”€â”€ -->
<div class="dismissed-screen" id="dismissed-screen">
    <p id="dismissed-text">Du kannst dieses Fenster jetzt schlieÃŸen.</p>
</div>

<!-- â”€â”€ TY logo â€” fixed top-left corner â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div style="position:fixed;top:20px;left:20px;width:220px;height:146px;background:#fff;border-radius:20px;box-shadow:0 2px 14px rgba(0,0,0,.12);display:flex;align-items:center;justify-content:center;z-index:10;padding:12px;">
    <img src="/static/images/icons/logo_full.png" alt="talent.yoga" style="width:190px;height:auto;object-fit:contain;">
</div>

<!-- â”€â”€ The wizard â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div class="wizard" id="wizard">
    <span class="step-counter" id="step-counter"></span>

    <!-- â•â•â•â•â•â•â•â• STEP 1 â€” Language â•â•â•â•â•â•â•â• -->
    <div class="step active" data-step="1">
        <h2 id="s1-title">Choose your language</h2>
        <p id="s1-subtitle">talent.yoga is available in German and English.</p>
        <div class="flag-row">
            <button class="flag-btn" data-lang="de" onclick="selectLanguage('de')"
                    onmouseenter="previewLang('de')" onmouseleave="previewLang(null)">
                ğŸ‡©ğŸ‡ª
                <span class="flag-label">Deutsch</span>
            </button>
            <button class="flag-btn" data-lang="en" onclick="selectLanguage('en')"
                    onmouseenter="previewLang('en')" onmouseleave="previewLang(null)">
                ğŸ‡¬ğŸ‡§
                <span class="flag-label">English</span>
            </button>
        </div>
    </div>

    <!-- â•â•â•â•â•â•â•â• STEP 2 â€” Germany notice â•â•â•â•â•â•â•â• -->
    <div class="step" data-step="2">
        <h2 id="s2-title"></h2>
        <div class="germany-visual">
            <img src="/static/images/germany_flag_map.png" alt="Germany" class="germany-map-img">
        </div>
        <div class="info-box">
            <p id="s2-info"></p>
        </div>
        <div class="btn-row">
            <button class="btn btn-secondary" onclick="goTo(1)">â† <span class="back-label"></span></button>
            <button class="btn btn-primary" onclick="goTo(nextStepFrom(2))">
                <span class="next-label"></span> â†’
            </button>
        </div>
    </div>

    <!-- â•â•â•â•â•â•â•â• STEP 3 â€” Du / Sie (DE only) â•â•â•â•â•â•â•â• -->
    <div class="step" data-step="3">
        <h2 id="s3-title"></h2>
        <p id="s3-subtitle"></p>
        <div style="margin-bottom:0.5rem;">
            <button class="btn btn-secondary btn-sm" onclick="goTo(2)" style="padding:0.3rem 0.8rem;font-size:0.85rem;">â† <span class="back-label"></span></button>
        </div>
        <div class="formality-row">
            <div class="formality-card" onclick="selectFormality('du')">
                <div class="big">Du</div>
                <div class="desc" id="s3-du-desc">Lass uns locker und offen reden.</div>
            </div>
            <div class="formality-card" onclick="selectFormality('sie')">
                <div class="big">Sie</div>
                <div class="desc" id="s3-sie-desc">Wir bleiben beim respektvollen Sie.</div>
            </div>
        </div>
    </div>

    <!-- â•â•â•â•â•â•â•â• STEP 4 â€” Privacy â•â•â•â•â•â•â•â• -->
    <div class="step" data-step="4">
        <h2 id="s4-title"></h2>
        <div class="privacy-content" id="s4-content"></div>
        <div class="btn-row-privacy">
            <button class="btn btn-danger" onclick="rejectPrivacy()" id="s4-reject"></button>
            <button class="btn btn-primary" onclick="goTo(5)" id="s4-accept" style="margin-left:auto;"></button>
        </div>
    </div>

    <!-- â•â•â•â•â•â•â•â• STEP 5 â€” Describe your vibe â•â•â•â•â•â•â•â• -->
    <div class="step" data-step="5">
        <h2 id="s5-title"></h2>
        <p id="s5-subtitle"></p>
        <input class="manual-input" id="keyword-input" type="text" placeholder="" maxlength="200"
               autocomplete="off" style="margin-bottom: 4px;"/>
        <div class="gender-row" style="margin-top: 8px;">
            <button class="gender-btn selected" data-gender="neutral" onclick="selectGender('neutral')">
                <span id="s5-gender-neutral"></span>
            </button>
            <button class="gender-btn" data-gender="feminine" onclick="selectGender('feminine')">
                <span id="s5-gender-feminine"></span>
            </button>
            <button class="gender-btn" data-gender="masculine" onclick="selectGender('masculine')">
                <span id="s5-gender-masculine"></span>
            </button>
        </div>
        <div class="btn-row">
            <button class="btn btn-ghost" onclick="goTo(7)" id="s5-manual-link"></button>
            <button class="btn btn-primary" id="btn-generate" onclick="generateLLMNames()">
                <span id="s5-generate-label"></span> â†’
            </button>
        </div>
    </div>

    <!-- â•â•â•â•â•â•â•â• STEP 6 â€” Taro results grid â•â•â•â•â•â•â•â• -->
    <div class="step" data-step="6">
        <h2 id="s6-title"></h2>
        <p id="s6-subtitle" style="font-size:13px;color:#64748b;margin-top:-12px;"></p>
        <div class="name-grid" id="name-grid">
            <!-- Filled by LLM -->
        </div>
        <div class="grid-footer">
            <button class="btn btn-ghost" onclick="goTo(5)" id="s6-retry-link">ğŸ”„</button>
            <button class="btn btn-ghost" onclick="goTo(7)" id="s6-manual-link"></button>
        </div>
        <div class="btn-row">
            <button class="btn btn-secondary" onclick="goTo(5)">â† <span class="back-label"></span></button>
            <button class="btn btn-primary" id="btn-confirm-grid" disabled onclick="confirmGridName()">
                <span class="next-label"></span>
            </button>
        </div>
    </div>

    <!-- â•â•â•â•â•â•â•â• STEP 7 â€” Manual entry â•â•â•â•â•â•â•â• -->
    <div class="step" data-step="7">
        <h2 id="s7-title"></h2>
        <p id="s7-subtitle"></p>
        <input class="manual-input" id="manual-name" type="text" placeholder="" maxlength="40"
               oninput="validateManualName()" autocomplete="off"/>
        <div class="validation-msg" id="validation-msg"></div>
        <div class="btn-row">
            <button class="btn btn-secondary" onclick="goTo(5)">â† <span class="back-label"></span></button>
            <button class="btn btn-primary" id="btn-confirm-manual" disabled onclick="confirmManualName()">
                <span id="s7-confirm-label"></span>
            </button>
        </div>
    </div>
</div>

<script>
(function() {
    "use strict";

    // â”€â”€ State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const state = {
        lang: null,         // 'de' | 'en'
        formality: 'du',    // 'du' | 'sie' (only matters for DE)
        gender: 'neutral',
        chosenName: null,
        currentStep: 1,
        totalSteps: 7,      // recalculated for EN (skip du/sie)
    };

    // â”€â”€ Copy â€” 3 variants: en, de_du, de_sie â”€â”€â”€â”€â”€â”€
    const COPY = {
        en: {
            step_counter: "Step {a} of {b}",
            s2_title: "talent.yoga currently only loads jobs from Germany!",
            s2_info: "We're working on expanding â€” but for now, all positions are within Germany.",
            s3_title: "",
            s3_subtitle: "",
            s4_title: "Your privacy matters",
            s4_content: [
                "We don't have your personal data â€” and that's by design. Your real name is never stored anywhere in our system.",
                "You operate behind a yogi name. Other yogis only see your yogi name â€” your real identity stays hidden.",
                "Since we don't hold personal data, it can't be leaked, hacked, or sold. What doesn't exist can't be compromised.",
                "All data stays on servers in Germany. EU law (GDPR) applies to everything we do.",
                "You can download or permanently delete your account at any time â€” no questions asked.",
            ],
            s4_accept: "I accept",
            s4_reject: "I decline",
            s5_title: "What inspires you?",
            s5_subtitle: "Type a few words that describe your vibe â€” Taro will create yogi names from them.",
            s5_placeholder: "e.g. forest, calm, tech, moon",
            s5_generate_label: "Generate",
            s5_manual_link: "I'd rather type my own â†’",
            s5_gender_neutral: "âœ¨ Neutral",
            s5_gender_feminine: "ğŸŒ¸ Feminine",
            s5_gender_masculine: "ğŸ”· Masculine",
            s6_title: "Pick a name",
            s6_subtitle: "Taro created these just for you.",
            s6_retry_link: "ğŸ”„ New words",
            s6_manual_link: "I'd rather type my own â†’",
            s7_title: "Enter your yogi name",
            s7_subtitle: "Choose a creative pseudonym. Not your real name â€” something unique.",
            s7_placeholder: "e.g. NorthstarCoder, CoffeeKoala",
            s7_confirm: "Confirm",
            next: "Next",
            back: "Back",
            dismissed: "You can close this window now.",
        },
        de_du: {
            step_counter: "Schritt {a} von {b}",
            s2_title: "Momentan lÃ¤dt talent.yoga nur Stellen aus Deutschland!",
            s2_info: "Wir arbeiten daran, das zu erweitern â€” aber im Moment sind alle Positionen innerhalb Deutschlands.",
            s3_title: "Wie wollen wir uns anreden?",
            s3_subtitle: "Du entscheidest, wie wir miteinander sprechen.",
            s4_title: "Deine Daten gehÃ¶ren dir",
            s4_content: [
                "Wir haben deine persÃ¶nlichen Daten gar nicht â€” und das ist Absicht. Dein echter Name wird nirgendwo in unserem System gespeichert.",
                "Du bist hinter einem Yogi-Namen unterwegs. Andere Yogis sehen nur deinen Yogi-Namen â€” deine echte IdentitÃ¤t bleibt verborgen.",
                "Da wir keine persÃ¶nlichen Daten besitzen, kÃ¶nnen sie auch nicht geleakt, gehackt oder verkauft werden. Was nicht existiert, kann nicht kompromittiert werden.",
                "Alle Daten liegen auf Servern in Deutschland. EU-Recht (DSGVO) gilt fÃ¼r alles, was wir tun.",
                "Du kannst jederzeit alle Daten herunterladen oder dein Konto dauerhaft lÃ¶schen â€” ohne RÃ¼ckfragen.",
            ],
            s4_accept: "Einverstanden",
            s4_reject: "Ablehnen",
            s5_title: "Was inspiriert dich?",
            s5_subtitle: "Schreib ein paar WÃ¶rter, die deine Stimmung beschreiben â€” Taro erfindet daraus Yogi-Namen.",
            s5_placeholder: "z.B. Wald, ruhig, Technik, Mond",
            s5_generate_label: "Generieren",
            s5_manual_link: "Ich tippe lieber selber â†’",
            s5_gender_neutral: "âœ¨ Neutral",
            s5_gender_feminine: "ğŸŒ¸ Feminin",
            s5_gender_masculine: "ğŸ”· Maskulin",
            s6_title: "WÃ¤hle einen Namen",
            s6_subtitle: "Taro hat diese fÃ¼r dich erfunden.",
            s6_retry_link: "ğŸ”„ Neue WÃ¶rter",
            s6_manual_link: "Ich tippe lieber selber â†’",
            s7_title: "Gib deinen Yogi-Namen ein",
            s7_subtitle: "WÃ¤hle ein kreatives Pseudonym. Nicht dein echter Name â€” etwas Einzigartiges.",
            s7_placeholder: "z.B. NordlichtCoder, KaffeeKoala",
            s7_confirm: "BestÃ¤tigen",
            next: "Weiter",
            back: "ZurÃ¼ck",
            dismissed: "Du kannst dieses Fenster jetzt schlieÃŸen.",
        },
        de_sie: {
            step_counter: "Schritt {a} von {b}",
            s2_title: "Momentan lÃ¤dt talent.yoga nur Stellen aus Deutschland!",
            s2_info: "Wir arbeiten daran, das zu erweitern â€” aber im Moment sind alle Positionen innerhalb Deutschlands.",
            s3_title: "Wie mÃ¶chten Sie angesprochen werden?",
            s3_subtitle: "Sie entscheiden, wie wir miteinander sprechen.",
            s4_title: "Ihre Daten gehÃ¶ren Ihnen",
            s4_content: [
                "Wir haben Ihre persÃ¶nlichen Daten gar nicht â€” und das ist Absicht. Ihr echter Name wird nirgendwo in unserem System gespeichert.",
                "Sie sind hinter einem Yogi-Namen unterwegs. Andere Yogis sehen nur Ihren Yogi-Namen â€” Ihre echte IdentitÃ¤t bleibt verborgen.",
                "Da wir keine persÃ¶nlichen Daten besitzen, kÃ¶nnen sie auch nicht geleakt, gehackt oder verkauft werden. Was nicht existiert, kann nicht kompromittiert werden.",
                "Alle Daten liegen auf Servern in Deutschland. EU-Recht (DSGVO) gilt fÃ¼r alles, was wir tun.",
                "Sie kÃ¶nnen jederzeit alle Daten herunterladen oder Ihr Konto dauerhaft lÃ¶schen â€” ohne RÃ¼ckfragen.",
            ],
            s4_accept: "Einverstanden",
            s4_reject: "Ablehnen",
            s5_title: "Was inspiriert Sie?",
            s5_subtitle: "Schreiben Sie ein paar WÃ¶rter, die Ihre Stimmung beschreiben â€” Taro erfindet daraus Yogi-Namen.",
            s5_placeholder: "z.B. Wald, ruhig, Technik, Mond",
            s5_generate_label: "Generieren",
            s5_manual_link: "Ich tippe lieber selber â†’",
            s5_gender_neutral: "âœ¨ Neutral",
            s5_gender_feminine: "ğŸŒ¸ Feminin",
            s5_gender_masculine: "ğŸ”· Maskulin",
            s6_title: "WÃ¤hlen Sie einen Namen",
            s6_subtitle: "Taro hat diese fÃ¼r Sie erfunden.",
            s6_retry_link: "ğŸ”„ Neue WÃ¶rter",
            s6_manual_link: "Ich tippe lieber selber â†’",
            s7_title: "Geben Sie Ihren Yogi-Namen ein",
            s7_subtitle: "WÃ¤hlen Sie ein kreatives Pseudonym. Nicht Ihr echter Name â€” etwas Einzigartiges.",
            s7_placeholder: "z.B. NordlichtCoder, KaffeeKoala",
            s7_confirm: "BestÃ¤tigen",
            next: "Weiter",
            back: "ZurÃ¼ck",
            dismissed: "Sie kÃ¶nnen dieses Fenster jetzt schlieÃŸen.",
        },
    };

    // â”€â”€ Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function c() {
        if (state.lang === 'en') return COPY.en;
        return state.formality === 'sie' ? COPY.de_sie : COPY.de_du;
    }

    function $(sel) { return document.querySelector(sel); }
    function $$(sel) { return document.querySelectorAll(sel); }

    function effectiveSteps() {
        // EN â†’ skip step 3 (Du/Sie), steps are 1,2,4,5,6,7 â†’ 6 total
        // DE â†’ all 7
        return state.lang === 'en' ? 6 : 7;
    }

    function visibleStepNumber(step) {
        if (state.lang !== 'en') return step;
        // EN: 1â†’1, 2â†’2, 4â†’3, 5â†’4, 6â†’5, 7â†’6
        const map = {1:1, 2:2, 4:3, 5:4, 6:5, 7:6};
        return map[step] || step;
    }

    // Which step comes after this one?
    window.nextStepFrom = function(step) {
        if (step === 2 && state.lang === 'en') return 4; // skip du/sie
        return step + 1;
    };

    // â”€â”€ Apply copy to UI â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function applyText() {
        const t = c();
        // Step counter
        const vis = visibleStepNumber(state.currentStep);
        const total = effectiveSteps();
        if (state.currentStep > 1) {
            $('#step-counter').textContent = t.step_counter.replace('{a}', vis).replace('{b}', total);
        } else {
            $('#step-counter').textContent = '';
        }

        // Step 2
        if ($('#s2-title')) $('#s2-title').textContent = t.s2_title;
        if ($('#s2-info'))  $('#s2-info').textContent = t.s2_info;

        // Step 3
        if ($('#s3-title'))    $('#s3-title').textContent = t.s3_title || '';
        if ($('#s3-subtitle')) $('#s3-subtitle').textContent = t.s3_subtitle || '';

        // Step 4
        if ($('#s4-title')) $('#s4-title').textContent = t.s4_title;
        if ($('#s4-content')) {
            const items = t.s4_content || [];
            $('#s4-content').innerHTML = '<ul>' + items.map(i => '<li>' + i + '</li>').join('') + '</ul>';
        }
        if ($('#s4-accept')) $('#s4-accept').textContent = t.s4_accept;
        if ($('#s4-reject')) $('#s4-reject').textContent = t.s4_reject;

        // Step 5 â€” keyword input
        if ($('#s5-title'))            $('#s5-title').textContent = t.s5_title;
        if ($('#s5-subtitle'))         $('#s5-subtitle').textContent = t.s5_subtitle;
        if ($('#keyword-input'))       $('#keyword-input').placeholder = t.s5_placeholder;
        if ($('#s5-generate-label'))   $('#s5-generate-label').textContent = t.s5_generate_label;
        if ($('#s5-manual-link'))      $('#s5-manual-link').textContent = t.s5_manual_link;
        if ($('#s5-gender-neutral'))   $('#s5-gender-neutral').textContent = t.s5_gender_neutral;
        if ($('#s5-gender-feminine'))  $('#s5-gender-feminine').textContent = t.s5_gender_feminine;
        if ($('#s5-gender-masculine')) $('#s5-gender-masculine').textContent = t.s5_gender_masculine;

        // Step 6 â€” LLM results
        if ($('#s6-title'))        $('#s6-title').textContent = t.s6_title;
        if ($('#s6-subtitle'))     $('#s6-subtitle').textContent = t.s6_subtitle;
        if ($('#s6-retry-link'))   $('#s6-retry-link').textContent = t.s6_retry_link;
        if ($('#s6-manual-link'))  $('#s6-manual-link').textContent = t.s6_manual_link;

        // Step 7
        if ($('#s7-title'))    $('#s7-title').textContent = t.s7_title;
        if ($('#s7-subtitle')) $('#s7-subtitle').textContent = t.s7_subtitle;
        if ($('#manual-name')) $('#manual-name').placeholder = t.s7_placeholder;
        if ($('#s7-confirm-label')) $('#s7-confirm-label').textContent = t.s7_confirm;

        // Generic labels
        $$('.next-label').forEach(el => el.textContent = t.next);
        $$('.back-label').forEach(el => el.textContent = t.back);

        // Dismissed screen
        if ($('#dismissed-text')) $('#dismissed-text').textContent = t.dismissed;
    }

    // â”€â”€ Navigation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    window.goTo = function(step) {
        const wizard = $('#wizard');
        wizard.classList.add('fade-out');
        setTimeout(() => {
            $$('.step').forEach(s => s.classList.remove('active'));
            const target = document.querySelector(`.step[data-step="${step}"]`);
            if (target) target.classList.add('active');
            state.currentStep = step;
            applyText();
            wizard.classList.remove('fade-out');
        }, 350);
    };

    // â”€â”€ Step 1 â€” Language select â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const s1Texts = {
        de: { title: 'WÃ¤hle deine Sprache', subtitle: 'talent.yoga ist auf Deutsch und Englisch verfÃ¼gbar.' },
        en: { title: 'Choose your language', subtitle: 'talent.yoga is available in German and English.' },
    };

    window.previewLang = function(lang) {
        const t = lang ? s1Texts[lang] : s1Texts.en;
        const h = $('#s1-title');
        const p = $('#s1-subtitle');
        if (h) h.textContent = t.title;
        if (p) p.textContent = t.subtitle;
    };

    window.selectLanguage = function(lang) {
        state.lang = lang;
        $$('.flag-btn').forEach(b => b.classList.toggle('selected', b.dataset.lang === lang));
        // If EN, formality is 'du' (informal English)
        if (lang === 'en') state.formality = 'du';
        applyText();
        setTimeout(() => goTo(2), 400);
    };

    // â”€â”€ Step 3 â€” Du / Sie â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    window.selectFormality = function(f) {
        state.formality = f;
        $$('.formality-card').forEach((card, i) => {
            card.classList.toggle('selected', (i === 0 && f === 'du') || (i === 1 && f === 'sie'));
        });
        applyText();
        setTimeout(() => goTo(4), 400);
    };

    // â”€â”€ Step 4 â€” Privacy reject â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    window.rejectPrivacy = function() {
        const screen = $('#dismissed-screen');
        screen.classList.add('active');
    };

    // â”€â”€ Step 5 â€” Gender select â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    window.selectGender = function(g) {
        state.gender = g;
        $$('.gender-btn').forEach(b => b.classList.toggle('selected', b.dataset.gender === g));
    };

    // â”€â”€ Step 5â†’6 â€” Generate LLM names â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    window.generateLLMNames = async function() {
        const keywords = ($('#keyword-input').value || '').trim();
        if (keywords.length < 2) {
            $('#keyword-input').focus();
            return;
        }
        // Navigate to step 6 immediately with spinner
        goTo(6);
        const grid = $('#name-grid');
        grid.innerHTML = '<div style="grid-column:1/-1;text-align:center;padding:24px;"><div class="spinner"></div></div>';
        state.chosenName = null;
        $('#btn-confirm-grid').disabled = true;
        try {
            const resp = await fetch(`/api/profiles/me/yogi-name/suggest-from-keywords?gender=${state.gender}&language=${state.lang}`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({keywords}),
            });
            const data = await resp.json();
            const names = data.suggestions || [];
            grid.innerHTML = '';
            if (names.length === 0) {
                grid.innerHTML = '<p style="grid-column:1/-1;text-align:center;color:#94a3b8;">No names generated â€” try different words.</p>';
                return;
            }
            names.forEach(name => {
                const chip = document.createElement('div');
                chip.className = 'name-chip';
                chip.textContent = name;
                chip.onclick = () => pickGridName(name, chip);
                grid.appendChild(chip);
            });
        } catch (e) {
            grid.innerHTML = '<p style="grid-column:1/-1;text-align:center;color:#dc2626;">Error generating names</p>';
        }
    };

    // Enter key triggers generate on keyword input
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Enter' && document.activeElement && document.activeElement.id === 'keyword-input') {
            e.preventDefault();
            generateLLMNames();
        }
    });

    function pickGridName(name, chip) {
        $$('.name-chip').forEach(c => c.classList.remove('selected'));
        chip.classList.add('selected');
        state.chosenName = name;
        $('#btn-confirm-grid').disabled = false;
    }

    window.confirmGridName = function() {
        if (!state.chosenName) return;
        completeOnboarding(state.chosenName);
    };

    // â”€â”€ Step 7 â€” Manual entry â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    let validateTimer = null;
    window.validateManualName = function() {
        const input = $('#manual-name');
        const msg = $('#validation-msg');
        const btn = $('#btn-confirm-manual');
        const name = input.value.trim();

        if (!name) {
            msg.textContent = '';
            msg.className = 'validation-msg';
            btn.disabled = true;
            return;
        }
        if (name.length < 3) {
            msg.textContent = state.lang === 'de'
                ? 'Mindestens 3 Zeichen'
                : 'At least 3 characters';
            msg.className = 'validation-msg error';
            btn.disabled = true;
            return;
        }

        clearTimeout(validateTimer);
        validateTimer = setTimeout(async () => {
            try {
                const resp = await fetch('/api/profiles/me/yogi-name', {
                    method: 'PUT',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({yogi_name: name, dry_run: true}),
                });
                const data = await resp.json();
                if (data.status === 'error') {
                    msg.textContent = data.error || data.detail || 'Invalid';
                    msg.className = 'validation-msg error';
                    btn.disabled = true;
                } else if (data.status === 'warning') {
                    msg.textContent = data.warning;
                    msg.className = 'validation-msg warning';
                    btn.disabled = false;
                } else {
                    msg.textContent = state.lang === 'de' ? 'âœ“ VerfÃ¼gbar' : 'âœ“ Available';
                    msg.className = 'validation-msg ok';
                    btn.disabled = false;
                }
            } catch (e) {
                msg.textContent = '';
                btn.disabled = false;
            }
        }, 400);
    };

    window.confirmManualName = function() {
        const name = $('#manual-name').value.trim();
        if (!name || name.length < 3) return;
        completeOnboarding(name);
    };

    // â”€â”€ Complete â€” save everything â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async function completeOnboarding(yogiName) {
        const btn = document.activeElement;
        if (btn) { btn.disabled = true; btn.innerHTML = '<div class="spinner"></div>'; }

        try {
            const resp = await fetch('/api/onboarding/complete', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    language: state.lang,
                    formality: state.formality,
                    yogi_name: yogiName,
                }),
            });
            const data = await resp.json();
            if (data.ok) {
                // Set language cookie so the app remembers
                document.cookie = `lang=${state.lang};path=/;max-age=${365*86400};samesite=lax`;
                window.location.href = '/dashboard';
            } else {
                alert(data.error || data.detail || 'Error');
                if (btn) { btn.disabled = false; btn.innerHTML = c().s7_confirm || 'Confirm'; }
            }
        } catch (e) {
            alert('Network error');
            if (btn) { btn.disabled = false; btn.innerHTML = c().s7_confirm || 'Confirm'; }
        }
    }

    // â”€â”€ Init â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    applyText();

})();
</script>
<!-- Feedback widget (Ctrl+F2 hotkey) -->
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script src="/static/js/feedback.js?v=20260219d"></script>
</body>
</html>
