#!/bin/bash
# turing-q - Quick database query tool
# Usage: turing-q "SELECT * FROM postings LIMIT 5"
#        turing-q -t "SELECT * FROM postings LIMIT 5"  # with timing
#
# Loads credentials from .env, runs query against turing database

set -e

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PROJECT_ROOT="$(cd "$SCRIPT_DIR/../.." && pwd)"

# Load .env
if [[ -f "$PROJECT_ROOT/.env" ]]; then
    source "$PROJECT_ROOT/.env"
else
    echo "Error: .env not found at $PROJECT_ROOT/.env" >&2
    exit 1
fi

# Parse options
TIMING=""
while getopts "t" opt; do
    case $opt in
        t) TIMING="\\timing on";;
    esac
done
shift $((OPTIND-1))

if [[ -z "$1" ]]; then
    echo "Usage: turing-q [-t] \"SQL query\"" >&2
    echo "  -t  Enable query timing" >&2
    exit 1
fi

# Run query
PGPASSWORD="$DB_PASSWORD" psql -h "$DB_HOST" -p "$DB_PORT" -U "$DB_USER" -d "$DB_NAME" -c "$TIMING" -c "$1"
